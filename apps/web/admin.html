<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cybersecurity Archive Admin</title>
  <style>
    :root {
      --bg: #0b0d12;
      --panel: #0f1320;
      --card: #111726;
      --border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --danger: #ff6b6b;
      --primary: #2f6bff;
      --primary2: #2458d6;
      --shadow: 0 16px 48px rgba(0,0,0,0.45);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 10% 0%, rgba(47,107,255,0.20), transparent 60%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(255,107,107,0.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height: 1.35;
    }
    a { color: inherit; }
    .wrap { max-width: 1120px; margin: 0 auto; padding: 28px 18px 80px; }
    .topbar {
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px 16px;
      border: 1px solid var(--border);
      background: rgba(17,23,38,0.8);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .title { font-weight: 800; letter-spacing: 0.2px; font-size: 18px; }
    .subtitle { color: var(--muted); font-size: 13px; margin-top: 4px; }
    .col { display:flex; flex-direction:column; }
    .grid { margin-top: 18px; display:grid; gap: 14px; grid-template-columns: repeat(12, 1fr); }
    .panel {
      grid-column: span 12;
      border: 1px solid var(--border);
      background: rgba(15,19,32,0.85);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    @media (min-width: 960px) {
      .panel.half { grid-column: span 6; }
      .panel.third { grid-column: span 4; }
    }
    .panel h2 { margin: 0 0 10px; font-size: 15px; }
    .muted { color: var(--muted); font-size: 13px; }
    .row { display:grid; grid-template-columns: 140px 1fr; gap: 10px; align-items:start; margin-top: 12px; }
    .label { color: var(--muted); font-size: 13px; padding-top: 10px; }
    .input, .textarea {
      width: 100%;
      padding: 10px 10px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      border-radius: 10px;
      outline: none;
    }
    .textarea { min-height: 90px; resize: vertical; }
    .btn {
      appearance:none;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 650;
      font-size: 13px;
    }
    .btn:hover { background: rgba(255,255,255,0.10); }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }
    .btn-primary {
      background: linear-gradient(180deg, rgba(47,107,255,0.92), rgba(36,88,214,0.92));
      border-color: rgba(47,107,255,0.40);
    }
    .btn-primary:hover { filter: brightness(1.05); }
    .btn-danger { border-color: rgba(255,107,107,0.55); }
    .btn-danger:hover { background: rgba(255,107,107,0.18); }
    .hint { font-size: 12px; color: var(--muted); }
    .err { margin-top: 6px; color: var(--danger); font-size: 12px; display:none; white-space: pre-wrap; }
    .card {
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(17,23,38,0.7);
      border-radius: 12px;
      padding: 12px;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display:none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 9999;
    }
    .modal {
      width: min(920px, 100%);
      max-height: 88vh;
      overflow: auto;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(15,19,32,0.95);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .modal-head { display:flex; align-items:center; justify-content:space-between; gap: 10px; }
    .modal-title { font-weight: 800; font-size: 15px; }
    .modal-actions { display:flex; gap: 10px; justify-content:flex-end; margin-top: 12px; flex-wrap: wrap; }
    .prelike { white-space: pre-wrap; border: 1px dashed rgba(255,255,255,0.20); border-radius: 12px; padding: 12px; background: rgba(0,0,0,0.15); margin-top: 10px; }
    .list { margin-top: 10px; display: grid; gap: 10px; }
    .es-item {
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(17,23,38,0.65);
      border-radius: 12px;
      padding: 12px;
    }
    .es-title { font-weight: 800; font-size: 14px; }
    .es-subtitle { margin-top: 6px; color: var(--muted); font-size: 12px; }
    .confirm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 10000;
    }
    .confirm {
      width: min(700px, 100%);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(15,19,32,0.98);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .confirm-title { font-weight: 800; }
    .confirm-body { margin-top: 10px; white-space: pre-wrap; color: var(--muted); font-size: 13px; }
    .confirm-actions { margin-top: 12px; display:flex; justify-content:flex-end; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="col">
        <div class="title">Cybersecurity Archive Admin</div>
        <div class="subtitle">企业/产品/领域/企业产品的录入与编辑（Admin Token 模式）</div>
      </div>
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <input id="adminTokenInput" class="input" style="width:260px;" type="password" placeholder="Admin Token（必填）" />
        <button id="adminTokenSave" class="btn btn-primary" type="button">保存 Token</button>
      </div>
    </div>

    <div class="grid">
      <div class="panel third">
        <h2>企业 / 机构</h2>
        <div class="muted">新增与编辑企业（当前功能正常，请勿改动此块的行为）。</div>
        <div class="modal-actions" style="justify-content:flex-start;">
          <button id="btnOpenOrganization" class="btn btn-primary" type="button">添加企业/机构</button>
          <button id="btnOpenOrganizationEdit" class="btn" type="button">编辑企业/机构</button>
        </div>
      </div>

      <div class="panel third">
        <h2>安全领域</h2>
        <div class="muted">新增/别名/编辑（当前版本：新增/编辑不可用，后续修复）。</div>
        <div class="modal-actions" style="justify-content:flex-start;">
          <button id="btnOpenDomain" class="btn btn-primary" type="button">添加安全领域</button>
          <button id="btnOpenDomainEdit" class="btn" type="button">编辑安全领域</button>
        </div>
      </div>

      <div class="panel third">
        <h2>安全产品</h2>
        <div class="muted">新增/别名/编辑（当前版本：新增/编辑不可用，后续修复）。</div>
        <div class="modal-actions" style="justify-content:flex-start;">
          <button id="btnOpenProduct" class="btn btn-primary" type="button">添加安全产品</button>
          <button id="btnOpenProductEdit" class="btn" type="button">编辑安全产品</button>
        </div>
      </div>

      <div class="panel half">
        <h2>企业产品（organization_product）</h2>
        <div class="muted">新增、编辑、删除企业产品记录（本次新增“产品评分”）。</div>
        <div class="modal-actions" style="justify-content:flex-start;">
          <button id="btnOpenOrgProduct" class="btn btn-primary" type="button">添加企业产品</button>
          <button id="btnOpenOrgProductEdit" class="btn" type="button">编辑企业产品</button>
        </div>
      </div>

      <div class="panel half">
        <h2>提示</h2>
        <div class="muted">
          - 需要先保存 Admin Token。<br/>
          - 企业产品：产品选择支持“产品/别名 union 搜索”。写入时使用归一后的主产品 ID。<br/>
          - 本次新增：产品评分 recommendation_score（0-10整数，选填）。
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       Organization Modal
       ========================= -->
  <div id="organizationModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="添加企业/机构">
      <div class="modal-head">
        <div class="modal-title">添加企业/机构</div>
        <button id="organizationClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">简称 *</div>
        <div>
          <input id="orgShortName" class="input" type="text" placeholder="如：OpenAI" />
          <div id="orgShortNameErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">全称</div>
        <div>
          <input id="orgFullName" class="input" type="text" placeholder="如：OpenAI, Inc." />
          <div id="orgFullNameErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">成立年份</div>
        <div>
          <input id="orgEstablishYear" class="input" type="text" inputmode="numeric" placeholder="选填：如 2015" />
          <div id="orgEstablishYearErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">slug *</div>
        <div>
          <input id="orgSlug" class="input" type="text" placeholder="如：openai（仅 a-z 0-9 -）" />
          <div id="orgSlugErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">描述</div>
        <div>
          <textarea id="orgDescription" class="textarea" placeholder="选填：企业简介、业务方向、备注等"></textarea>
          <div id="orgDescriptionErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">是否上市</div>
        <div style="display:flex; gap: 10px; align-items:center;">
          <input id="orgIfIpo" type="checkbox" />
          <span class="hint">勾选表示已上市</span>
        </div>
      </div>

      <div class="modal-actions">
        <button id="orgReset" class="btn" type="button">清空</button>
        <button id="orgSubmit" class="btn btn-primary" type="button">添加</button>
      </div>
    </div>
  </div>

  <!-- =========================
       Organization Edit Modal
       ========================= -->
  <div id="organizationEditModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="编辑企业/机构">
      <div class="modal-head">
        <div class="modal-title">编辑企业/机构</div>
        <button id="organizationEditClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">搜索企业</div>
        <div>
          <input id="orgEditSearch" class="input" type="text" placeholder="输入 short_name / full_name / slug ..." />
          <div id="orgEditStatus" class="hint" style="margin-top:6px;">输入关键字开始搜索。</div>
          <div id="orgEditList" class="list"></div>
          <div id="orgEditErr" class="err"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       Domain Modal
       ========================= -->
  <div id="domainModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="添加安全领域">
      <div class="modal-head">
        <div class="modal-title">添加安全领域</div>
        <button id="domainClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">领域名称 *</div>
        <div>
          <input id="domainName" class="input" type="text" placeholder="如：Endpoint Security" />
          <div id="domainNameErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">slug *</div>
        <div>
          <input id="domainSlug" class="input" type="text" placeholder="如：endpoint-security" />
          <div id="domainSlugErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">描述</div>
        <div>
          <textarea id="domainDesc" class="textarea" placeholder="选填"></textarea>
          <div id="domainDescErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">别名（可选）</div>
        <div>
          <textarea id="domainAlias" class="textarea" placeholder="一行一个别名（选填）"></textarea>
          <div id="domainAliasErr" class="err"></div>
        </div>
      </div>

      <div class="modal-actions">
        <button id="domainReset" class="btn" type="button">清空</button>
        <button id="domainSubmit" class="btn btn-primary" type="button">添加</button>
      </div>
    </div>
  </div>

  <!-- =========================
       Product Modal
       ========================= -->
  <div id="productModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="添加安全产品">
      <div class="modal-head">
        <div class="modal-title">添加安全产品</div>
        <button id="productClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">产品名称 *</div>
        <div>
          <input id="productName" class="input" type="text" placeholder="如：CrowdStrike Falcon" />
          <div id="productNameErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">slug *</div>
        <div>
          <input id="productSlug" class="input" type="text" placeholder="如：crowdstrike-falcon" />
          <div id="productSlugErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">描述</div>
        <div>
          <textarea id="productDesc" class="textarea" placeholder="选填"></textarea>
          <div id="productDescErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">选择安全领域</div>
        <div>
          <div id="productDomainGrid"></div>
          <div id="productDomainErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">别名（可选）</div>
        <div>
          <textarea id="productAlias" class="textarea" placeholder="一行一个别名（选填）"></textarea>
          <div id="productAliasErr" class="err"></div>
        </div>
      </div>

      <div class="modal-actions">
        <button id="productReset" class="btn" type="button">清空</button>
        <button id="productSubmit" class="btn btn-primary" type="button">添加</button>
      </div>
    </div>
  </div>

  <!-- =========================
       ✅ OrgProduct Add Modal
       ========================= -->
  <div id="orgProductModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="添加企业产品">
      <div class="modal-head">
        <div class="modal-title">添加企业产品</div>
        <button id="orgProductClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">企业 *</div>
        <div>
          <div class="card" style="margin-top:0;">
            <div class="label">选择企业/机构（单选）</div>
            <div class="hint" id="orgProductOrgPicked" style="margin-top:6px;">未选择（请在下方搜索并点击一个企业/机构）</div>
            <div class="modal-actions" style="justify-content:flex-start; margin-top:10px;">
              <button id="orgProductOrgClear" class="btn" type="button" style="display:none;">清除已选择</button>
            </div>
            <div style="margin-top:10px;">
              <input id="orgProductOrgSearch" class="input" type="text" placeholder="搜索 short_name / full_name / slug ..." />
              <div id="orgProductOrgStatus" class="hint" style="margin-top:6px;">输入关键字开始搜索。</div>
              <div id="orgProductOrgList" style="margin-top:10px;"></div>
              <div id="orgProductOrgErr" class="err"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="label">产品名称 *</div>
        <div>
          <div class="card" style="margin-top:0;">
            <div class="label">选择安全产品 / 别名（单选）</div>
            <div class="hint" id="orgProductProdPicked" style="margin-top:6px;">未选择（请在下方搜索并点击一个安全产品/别名）</div>
            <div class="modal-actions" style="justify-content:flex-start; margin-top:10px;">
              <button id="orgProductProdClear" class="btn" type="button" style="display:none;">清除已选择</button>
            </div>
            <div style="margin-top:10px;">
              <input id="orgProductProdSearch" class="input" type="text" placeholder="搜索产品名 / 别名 / slug ..." />
              <div id="orgProductProdStatus" class="hint" style="margin-top:6px;">输入关键字开始搜索。</div>
              <div id="orgProductProdList" style="margin-top:10px;"></div>
              <div id="orgProductProdErr" class="err"></div>
            </div>

            <div class="hint">写入时保存归一后的主产品 ID（security_product_id）。</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="label">产品发布年份</div>
        <div>
          <input id="orgProductReleaseYear" class="input" type="text" inputmode="numeric" placeholder="选填：1990 ~ 当前年份" />
          <div id="orgProductReleaseYearErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">产品终止年份</div>
        <div>
          <input id="orgProductEndYear" class="input" type="text" inputmode="numeric" placeholder="选填：1990 ~ 当前年份" />
          <div id="orgProductEndYearErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">产品评分</div>
        <div>
          <input id="orgProductScore" class="input" type="text" inputmode="numeric" placeholder="选填：0 ~ 10（整数）" />
          <div id="orgProductScoreErr" class="err"></div>
        </div>
      </div>

      <div class="modal-actions">
        <button id="orgProductReset" class="btn" type="button">清空</button>
        <button id="orgProductSubmit" class="btn btn-primary" type="button">添加</button>
      </div>
    </div>
  </div>

  <!-- =========================
       ✅ OrgProduct Edit Modal
       ========================= -->
  <div id="orgProductEditModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="编辑企业产品">
      <div class="modal-head">
        <div class="modal-title">编辑企业产品</div>
        <button id="orgProductEditClose" class="btn" type="button">关闭</button>
      </div>

      <div class="row">
        <div class="label">企业 *</div>
        <div>
          <div class="card" style="margin-top:0;">
            <div class="label">选择企业/机构（单选）</div>
            <div class="hint" id="orgProductEditOrgPicked" style="margin-top:6px;">未选择（请在下方搜索并点击一个企业/机构）</div>

            <div class="modal-actions" style="justify-content:flex-start; margin-top:10px;">
              <button id="orgProductEditOrgClear" class="btn" type="button" style="display:none;">清除已选择</button>
            </div>

            <div style="margin-top:10px;">
              <input id="orgProductEditOrgSearch" class="input" type="text" placeholder="搜索 short_name / full_name / slug ..." />
              <div id="orgProductEditOrgStatus" class="hint" style="margin-top:6px;">输入关键字开始搜索。</div>
              <div id="orgProductEditOrgList" style="margin-top:10px;"></div>
              <div id="orgProductEditOrgErr" class="err"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="orgProductEditListStatus" class="hint" style="margin-top:8px;">请选择企业后查看该企业已录入的产品。</div>
      <div id="orgProductEditList" class="list"></div>
    </div>
  </div>

  <!-- =========================
       ✅ OrgProduct Edit Item Modal
       ========================= -->
  <div id="orgProductEditItemModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="编辑企业产品（年份）">
      <div class="modal-head">
        <div class="modal-title">编辑企业产品（年份）</div>
        <button id="orgProductEditItemClose" class="btn" type="button">关闭</button>
      </div>

      <div class="card" style="margin-top:0;">
        <div class="label">企业</div>
        <div id="orgProductEditItemOrgName" class="hint" style="margin-top:6px;"></div>
        <div class="label" style="margin-top:10px;">产品</div>
        <div id="orgProductEditItemProdName" class="hint" style="margin-top:6px;"></div>
      </div>

      <div class="row">
        <div class="label">发布年份</div>
        <div>
          <input id="orgProductEditItemReleaseYear" class="input" type="text" inputmode="numeric" placeholder="选填：1990 ~ 当前年份" />
          <div id="orgProductEditItemReleaseYearErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">终止年份</div>
        <div>
          <input id="orgProductEditItemEndYear" class="input" type="text" inputmode="numeric" placeholder="选填：1990 ~ 当前年份" />
          <div id="orgProductEditItemEndYearErr" class="err"></div>
        </div>
      </div>

      <div class="row">
        <div class="label">产品评分</div>
        <div>
          <input id="orgProductEditItemScore" class="input" type="text" inputmode="numeric" placeholder="选填：0 ~ 10（整数）" />
          <div id="orgProductEditItemScoreErr" class="err"></div>
        </div>
      </div>

      <div id="orgProductEditItemPreview" class="prelike" style="display:none;"></div>

      <div class="modal-actions">
        <button id="orgProductEditItemCancel" class="btn" type="button">取消</button>
        <button id="orgProductEditItemSubmit" class="btn btn-primary" type="button">确定（预览修改）</button>
      </div>
    </div>
  </div>

  <!-- Confirm overlay -->
  <div id="confirmOverlay" class="confirm-overlay" aria-hidden="true">
    <div class="confirm" role="dialog" aria-modal="true" aria-label="状态">
      <div id="confirmTitle" class="confirm-title">处理中</div>
      <div id="confirmBody" class="confirm-body">请稍候…</div>
      <div class="confirm-actions">
        <button id="confirmOk" class="btn btn-primary" type="button">确定</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/admin.js"></script>
</body>
</html>
